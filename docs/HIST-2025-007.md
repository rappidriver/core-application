# HIST-2025-007: Implementar Cadastro e Manuten√ß√£o de Ve√≠culos

**Data**: 03/01/2026  
**Status**: üöß IN PROGRESS  
**Tipo**: Feature

## Descri√ß√£o

Implementar o m√≥dulo completo de **cadastro e gerenciamento de ve√≠culos** para a plataforma RappiDrive. Motoristas precisam ter ve√≠culos cadastrados e associados para aceitar corridas. Esta funcionalidade √© essencial para o MVP e permite configura√ß√µes espec√≠ficas por tipo de ve√≠culo (sedan, SUV, van).

## Contexto de Neg√≥cio

**Motiva√ß√£o**:
- Motoristas precisam registrar ve√≠culos antes de aceitar corridas
- Cada motorista pode ter m√∫ltiplos ve√≠culos (mas apenas um ativo por vez)
- Passageiros podem filtrar corridas por tipo de ve√≠culo
- Regulamenta√ß√£o exige rastreamento de ve√≠culos utilizados nas corridas
- Valida√ß√£o de documenta√ß√£o veicular (CRLV, seguro)

**Regras de Neg√≥cio**:
1. Motorista pode ter N ve√≠culos cadastrados
2. Apenas 1 ve√≠culo pode estar ACTIVE por motorista
3. Placa deve ser √∫nica no sistema (por tenant)
4. **Ano do ve√≠culo deve ser no m√°ximo 10 anos atr√°s**
5. **Somente ve√≠culos de passeio s√£o aceitos**: SEDAN, HATCHBACK, SUV (VAN e PICKUP n√£o permitidos)
6. **Ve√≠culo deve ter exatamente 4 portas**
7. Ve√≠culo em MAINTENANCE n√£o pode aceitar corridas
8. Valida√ß√£o de placa no formato brasileiro (ABC-1234 ou ABC1D234)

## Objetivos

### Domain Layer
1. ‚úÖ **Vehicle Entity**: Aggregate root para ve√≠culo
2. ‚úÖ **Value Objects**: LicensePlate, VehicleYear
3. ‚úÖ **Enums**: VehicleType, VehicleStatus
4. ‚úÖ **Business Rules**: Valida√ß√µes de dom√≠nio

### Application Layer
5. ‚úÖ **Output Ports**: VehicleRepositoryPort
6. ‚úÖ **Input Ports**: CreateVehicle, GetVehicle, UpdateVehicle, AssignVehicleToDriver, ActivateVehicle
7. ‚úÖ **Use Cases**: Implementa√ß√µes dos casos de uso

### Infrastructure Layer
8. ‚úÖ **JPA Entity**: VehicleJpaEntity
9. ‚úÖ **Repository**: Spring Data JPA repository
10. ‚úÖ **Adapter**: JpaVehicleRepositoryAdapter
11. ‚úÖ **Mapper**: VehicleMapper (MapStruct)
12. ‚úÖ **Migration**: V4__Create_vehicles_table.sql

### Presentation Layer
13. ‚úÖ **REST Controller**: VehicleController
14. ‚úÖ **DTOs**: CreateVehicleRequest, VehicleResponse
15. ‚úÖ **Mappers**: VehicleDtoMapper

### Testing
16. ‚úÖ **Unit Tests**: VehicleTest, LicensePlateTest, VehicleYearTest
17. ‚úÖ **Use Case Tests**: CreateVehicleUseCaseTest, etc.
18. ‚úÖ **Architecture Tests**: Atualizar regras

## Estrutura de Pacotes

```
src/main/java/com/rappidrive/
‚îú‚îÄ‚îÄ domain/
‚îÇ   ‚îú‚îÄ‚îÄ entities/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Vehicle.java                                  ‚úÖ NEW
‚îÇ   ‚îú‚îÄ‚îÄ valueobjects/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LicensePlate.java                            ‚úÖ NEW
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ VehicleYear.java                             ‚úÖ NEW
‚îÇ   ‚îú‚îÄ‚îÄ enums/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ VehicleType.java                             ‚úÖ NEW
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ VehicleStatus.java                           ‚úÖ NEW
‚îÇ   ‚îî‚îÄ‚îÄ exceptions/
‚îÇ       ‚îú‚îÄ‚îÄ VehicleNotFoundException.java                ‚úÖ NEW
‚îÇ       ‚îî‚îÄ‚îÄ InvalidVehicleStateException.java            ‚úÖ NEW
‚îú‚îÄ‚îÄ application/
‚îÇ   ‚îú‚îÄ‚îÄ ports/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ input/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ vehicle/
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ CreateVehicleInputPort.java          ‚úÖ NEW
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ GetVehicleInputPort.java             ‚úÖ NEW
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ UpdateVehicleInputPort.java          ‚úÖ NEW
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ AssignVehicleToDriverInputPort.java  ‚úÖ NEW
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ ActivateVehicleInputPort.java        ‚úÖ NEW
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ output/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ VehicleRepositoryPort.java               ‚úÖ NEW
‚îÇ   ‚îî‚îÄ‚îÄ usecases/
‚îÇ       ‚îî‚îÄ‚îÄ vehicle/
‚îÇ           ‚îú‚îÄ‚îÄ CreateVehicleUseCase.java                ‚úÖ NEW
‚îÇ           ‚îú‚îÄ‚îÄ GetVehicleUseCase.java                   ‚úÖ NEW
‚îÇ           ‚îú‚îÄ‚îÄ UpdateVehicleUseCase.java                ‚úÖ NEW
‚îÇ           ‚îú‚îÄ‚îÄ AssignVehicleToDriverUseCase.java        ‚úÖ NEW
‚îÇ           ‚îî‚îÄ‚îÄ ActivateVehicleUseCase.java              ‚úÖ NEW
‚îú‚îÄ‚îÄ infrastructure/
‚îÇ   ‚îú‚îÄ‚îÄ persistence/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ entities/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ VehicleJpaEntity.java                    ‚úÖ NEW
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ repositories/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SpringDataVehicleRepository.java         ‚úÖ NEW
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ adapters/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ JpaVehicleRepositoryAdapter.java         ‚úÖ NEW
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ mappers/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ VehicleMapper.java                       ‚úÖ NEW
‚îÇ   ‚îî‚îÄ‚îÄ config/
‚îÇ       ‚îî‚îÄ‚îÄ UseCaseConfiguration.java                    ‚úÖ MODIFIED
‚îî‚îÄ‚îÄ presentation/
    ‚îú‚îÄ‚îÄ controllers/
    ‚îÇ   ‚îî‚îÄ‚îÄ VehicleController.java                       ‚úÖ NEW
    ‚îú‚îÄ‚îÄ dto/
    ‚îÇ   ‚îú‚îÄ‚îÄ request/
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CreateVehicleRequest.java                ‚úÖ NEW
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ UpdateVehicleRequest.java                ‚úÖ NEW
    ‚îÇ   ‚îî‚îÄ‚îÄ response/
    ‚îÇ       ‚îî‚îÄ‚îÄ VehicleResponse.java                     ‚úÖ NEW
    ‚îî‚îÄ‚îÄ mappers/
        ‚îî‚îÄ‚îÄ VehicleDtoMapper.java                        ‚úÖ NEW

src/main/resources/db/migration/
‚îî‚îÄ‚îÄ V4__Create_vehicles_table.sql                        ‚úÖ NEW

src/test/java/com/rappidrive/
‚îú‚îÄ‚îÄ domain/
‚îÇ   ‚îú‚îÄ‚îÄ entities/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ VehicleTest.java                             ‚úÖ NEW
‚îÇ   ‚îî‚îÄ‚îÄ valueobjects/
‚îÇ       ‚îú‚îÄ‚îÄ LicensePlateTest.java                        ‚úÖ NEW
‚îÇ       ‚îî‚îÄ‚îÄ VehicleYearTest.java                         ‚úÖ NEW
‚îú‚îÄ‚îÄ application/
‚îÇ   ‚îî‚îÄ‚îÄ usecases/
‚îÇ       ‚îî‚îÄ‚îÄ vehicle/
‚îÇ           ‚îú‚îÄ‚îÄ CreateVehicleUseCaseTest.java            ‚úÖ NEW
‚îÇ           ‚îú‚îÄ‚îÄ GetVehicleUseCaseTest.java               ‚úÖ NEW
‚îÇ           ‚îî‚îÄ‚îÄ ActivateVehicleUseCaseTest.java          ‚úÖ NEW
‚îî‚îÄ‚îÄ architecture/
    ‚îî‚îÄ‚îÄ HexagonalArchitectureTest.java                   ‚úÖ MODIFIED
```

## Domain Model

### Vehicle Entity

**Campos**:
```java
public class Vehicle {
    private final UUID id;
    private final TenantId tenantId;
    private UUID driverId;                    // Nullable - pode n√£o estar associado ainda
    private final LicensePlate licensePlate;
    private final String brand;               // Ex: "Toyota", "Honda"
    private final String model;               // Ex: "Corolla", "Civic"
    private final VehicleYear year;
    private final String color;
    private final VehicleType type;           // SEDAN, HATCHBACK, SUV (apenas ve√≠culos de passeio)
    private final int numberOfDoors;          // Deve ser exatamente 4
    private final int seats;                  // N√∫mero de assentos
    private VehicleStatus status;             // ACTIVE, INACTIVE, MAINTENANCE
    private final LocalDateTime createdAt;
    private LocalDateTime updatedAt;
}
```

**Construtores**:
```java
// Creation constructor
public Vehicle(UUID id, TenantId tenantId, LicensePlate licensePlate, 
               String brand, String model, VehicleYear year, 
               String color, VehicleType type, int numberOfDoors, int seats) {
    // Valida√ß√£o: numberOfDoors deve ser 4
    // Valida√ß√£o: type deve ser SEDAN, HATCHBACK ou SUV
}

// Reconstruction constructor (persistence)
public Vehicle(UUID id, TenantId tenantId, UUID driverId, 
               LicensePlate licensePlate, String brand, String model, 
               VehicleYear year, String color, VehicleType type, 
               int numberOfDoors, int seats, VehicleStatus status)
```

**Comportamentos**:
```java
public void assignDriver(UUID driverId)           // Associa ve√≠culo a motorista
public void unassignDriver()                      // Remove associa√ß√£o
public void activate()                            // Status ‚Üí ACTIVE
    // Valida√ß√µes:
    // - driverId n√£o-nulo
    // - year n√£o pode ter mais de 10 anos
    // - numberOfDoors deve ser 4
    // - type deve ser ve√≠culo de passeio (SEDAN, HATCHBACK, SUV)
public void deactivate()                          // Status ‚Üí INACTIVE
public void markAsInMaintenance()                 // Status ‚Üí MAINTENANCE
public boolean canAcceptRides()                   // ACTIVE status check
public boolean isOwnedBy(UUID driverId)          // Valida√ß√£o de propriedade
public boolean isPassengerVehicle()              // Verifica se √© SEDAN, HATCHBACK ou SUV
```

**Invariantes**:
- licensePlate n√£o-nulo
- brand/model n√£o-vazios
- **numberOfDoors deve ser exatamente 4**
- seats >= 1 e <= 7
- **type deve ser SEDAN, HATCHBACK ou SUV (apenas ve√≠culos de passeio)**
- **year n√£o pode ter mais de 10 anos**
- Ve√≠culo s√≥ pode estar ACTIVE se tiver driverId
- Um motorista s√≥ pode ter 1 ve√≠culo ACTIVE

### LicensePlate Value Object

**Formato brasileiro**:
- **Antigo**: ABC-1234 (3 letras + 4 n√∫meros)
- **Mercosul**: ABC1D23 (3 letras + 1 n√∫mero + 1 letra + 2 n√∫meros)

**Valida√ß√µes**:
```java
public final class LicensePlate {
    private final String value;
    
    public LicensePlate(String value) {
        validateFormat(value);
        this.value = normalize(value); // Remove h√≠fens, uppercase
    }
    
    private void validateFormat(String plate) {
        // Regex: ^[A-Z]{3}[0-9]{4}$ ou ^[A-Z]{3}[0-9][A-Z][0-9]{2}$
    }
    
    public String getFormatted() {
        // ABC1234 ‚Üí ABC-1234
    }
}
```

### VehicleYear Value Object

**Valida√ß√µes**:
```java
public final class VehicleYear {
    private final int value;
    private static final int MAX_AGE = 10; // M√°ximo 10 anos atr√°s
    
    public VehicleYear(int year) {
        validateYear(year);
        this.value = year;
    }
    
    private void validateYear(int year) {
        int currentYear = LocalDate.now().getYear();
        if (year < (currentYear - MAX_AGE) || year > (currentYear + 1)) {
            throw new IllegalArgumentException("Invalid vehicle year");
        }
    }
    
    public boolean isOlderThan(int years) {
        return (LocalDate.now().getYear() - value) > years;
    }
}
```

### Enums

**VehicleType**:
```java
public enum VehicleType {
    SEDAN,      // Conforto, 4 portas, 4-5 passageiros
    HATCHBACK,  // Compacto, 4 portas, 4-5 passageiros
    SUV         // Espa√ßoso, 4 portas, 5-7 passageiros
    // VAN e PICKUP removidos: n√£o s√£o ve√≠culos de passeio
}
```

**VehicleStatus**:
```java
public enum VehicleStatus {
    ACTIVE,       // Dispon√≠vel para corridas
    INACTIVE,     // Cadastrado mas n√£o dispon√≠vel
    MAINTENANCE   // Em manuten√ß√£o
}
```

## Database Schema (Migration V4)

```sql
-- V4__Create_vehicles_table.sql
CREATE TABLE IF NOT EXISTS vehicles (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    tenant_id UUID NOT NULL,
    driver_id UUID,
    
    -- Vehicle details
    license_plate VARCHAR(8) NOT NULL,
    brand VARCHAR(50) NOT NULL,
    model VARCHAR(100) NOT NULL,
    year INTEGER NOT NULL,
    color VARCHAR(30) NOT NULL,
    vehicle_type VARCHAR(20) NOT NULL,
    number_of_doors INTEGER NOT NULL,
    seats INTEGER NOT NULL,
    
    -- Status
    status VARCHAR(20) NOT NULL DEFAULT 'INACTIVE',
    
    -- Audit fields
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    
    -- Constraints
    CONSTRAINT fk_vehicle_tenant FOREIGN KEY (tenant_id) REFERENCES tenants(id),
    CONSTRAINT fk_vehicle_driver FOREIGN KEY (driver_id) REFERENCES drivers(id),
    CONSTRAINT chk_vehicle_status CHECK (status IN ('ACTIVE', 'INACTIVE', 'MAINTENANCE')),
    CONSTRAINT chk_vehicle_type CHECK (vehicle_type IN ('SEDAN', 'HATCHBACK', 'SUV')),
    CONSTRAINT chk_number_of_doors CHECK (number_of_doors = 4),
    CONSTRAINT chk_vehicle_seats CHECK (seats >= 1 AND seats <= 12),
    CONSTRAINT chk_vehicle_year CHECK (year >= 2015 AND year <= 2030)
);

-- Indexes
CREATE UNIQUE INDEX idx_vehicles_license_plate_tenant ON vehicles(license_plate, tenant_id);
CREATE INDEX idx_vehicles_driver ON vehicles(driver_id);
CREATE INDEX idx_vehicles_tenant ON vehicles(tenant_id);
CREATE INDEX idx_vehicles_status_tenant ON vehicles(status, tenant_id);

-- Only one ACTIVE vehicle per driver
CREATE UNIQUE INDEX idx_vehicles_active_per_driver 
    ON vehicles(driver_id) 
    WHERE status = 'ACTIVE';

-- Comments
COMMENT ON TABLE vehicles IS 'Vehicles registered in the platform';
COMMENT ON COLUMN vehicles.license_plate IS 'Brazilian license plate (ABC-1234 or ABC1D23)';
COMMENT ON COLUMN vehicles.vehicle_type IS 'Type: SEDAN, HATCHBACK, SUV (passenger vehicles only)';
COMMENT ON COLUMN vehicles.number_of_doors IS 'Must be exactly 4 doors';
COMMENT ON INDEX idx_vehicles_active_per_driver IS 'Ensures only one active vehicle per driver';

-- Trigger for updated_at
CREATE TRIGGER update_vehicles_updated_at 
    BEFORE UPDATE ON vehicles
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
```

**√çndice √önico Condicional**: Garante que um motorista tenha apenas 1 ve√≠culo ACTIVE.

## Use Cases

### 1. CreateVehicleUseCase

**Input Port**:
```java
public interface CreateVehicleInputPort {
    Vehicle execute(CreateVehicleCommand command);
    
    record CreateVehicleCommand(
        TenantId tenantId,
        LicensePlate licensePlate,
        String brand,
        String model,
        VehicleYear year,
        String color,
        VehicleType type,
        int numberOfDoors,
        int seats
    ) {}
}
```

**Regras**:
- Validar placa √∫nica (por tenant)
- Criar ve√≠culo com status INACTIVE
- Sem driverId inicialmente

### 2. AssignVehicleToDriverUseCase

**Input Port**:
```java
public interface AssignVehicleToDriverInputPort {
    Vehicle execute(AssignVehicleCommand command);
    
    record AssignVehicleCommand(
        UUID vehicleId,
        UUID driverId
    ) {}
}
```

**Regras**:
- Validar se motorista existe
- Validar se ve√≠culo est√° dispon√≠vel
- Associar ve√≠culo ao motorista

### 3. ActivateVehicleUseCase

**Input Port**:
```java
public interface ActivateVehicleInputPort {
    Vehicle execute(UUID vehicleId);
}
```

**Regras**:
- Ve√≠culo deve ter driverId associado
- Desativar ve√≠culo ACTIVE anterior do motorista (se existir)
- Ativar ve√≠culo atual
- Usar transa√ß√£o para garantir atomicidade

### 4. GetVehicleInputPort

**Input Port**:
```java
public interface GetVehicleInputPort {
    Vehicle execute(UUID vehicleId);
    List<Vehicle> findByDriver(UUID driverId);
    Optional<Vehicle> findActiveByDriver(UUID driverId);
}
```

### 5. UpdateVehicleUseCase

**Input Port**:
```java
public interface UpdateVehicleInputPort {
    Vehicle execute(UpdateVehicleCommand command);
    
    record UpdateVehicleCommand(
        UUID vehicleId,
        String color,           // Campos atualiz√°veis
        VehicleStatus status
    ) {}
}
```

## Repository Port

**VehicleRepositoryPort**:
```java
public interface VehicleRepositoryPort {
    Vehicle save(Vehicle vehicle);
    Optional<Vehicle> findById(UUID id);
    List<Vehicle> findByTenantId(TenantId tenantId);
    List<Vehicle> findByDriverId(UUID driverId);
    Optional<Vehicle> findActiveByDriverId(UUID driverId);
    Optional<Vehicle> findByLicensePlate(LicensePlate licensePlate, TenantId tenantId);
    boolean existsByLicensePlate(LicensePlate licensePlate, TenantId tenantId);
    void delete(UUID id);
}
```

## REST API

### Endpoints

**POST /api/v1/vehicles**
```json
Request:
{
  "tenantId": "uuid",
  "licensePlate": "ABC1D23",
  "brand": "Toyota",
  "model": "Corolla",
  "year": 2022,
  "color": "Prata",
  "type": "SEDAN",
  "numberOfDoors": 4,
  "seats": 5
}

Response: 201 Created
{
  "id": "uuid",
  "tenantId": "uuid",
  "licensePlate": "ABC-1D23",
  "brand": "Toyota",
  "model": "Corolla",
  "year": 2022,
  "color": "Prata",
  "type": "SEDAN",
  "numberOfDoors": 4,
  "seats": 5,
  "status": "INACTIVE",
  "driverId": null,
  "createdAt": "2026-01-03T18:00:00",
  "updatedAt": "2026-01-03T18:00:00"
}
```

**PUT /api/v1/vehicles/{id}/assign**
```json
Request:
{
  "driverId": "uuid"
}

Response: 200 OK
```

**PUT /api/v1/vehicles/{id}/activate**
```
Response: 200 OK
```

**GET /api/v1/vehicles/{id}**
```
Response: 200 OK
```

**GET /api/v1/vehicles/driver/{driverId}**
```
Response: 200 OK - Lista de ve√≠culos do motorista
```

**GET /api/v1/vehicles/driver/{driverId}/active**
```
Response: 200 OK - Ve√≠culo ativo do motorista
```

## Testes

### Domain Tests

**VehicleTest** (~30 tests):
- ‚úÖ shouldCreateVehicleWithValidData
- ‚úÖ shouldThrowExceptionWhenLicensePlateIsNull
- ‚úÖ shouldThrowExceptionWhenBrandIsEmpty
- ‚úÖ shouldThrowExceptionWhenSeatsInvalid
- ‚úÖ **shouldThrowExceptionWhenNumberOfDoorsIsNot4**
- ‚úÖ **shouldThrowExceptionWhenVehicleTypeIsNotPassenger (VAN/PICKUP)**
- ‚úÖ **isPassengerVehicleShouldReturnTrueForSedan**
- ‚úÖ **isPassengerVehicleShouldReturnTrueForHatchback**
- ‚úÖ **isPassengerVehicleShouldReturnTrueForSUV**
- ‚úÖ shouldAssignDriverToVehicle
- ‚úÖ shouldUnassignDriver
- ‚úÖ shouldActivateVehicle (valida 4 portas + tipo passeio + max 10 anos)
- ‚úÖ shouldDeactivateVehicle
- ‚úÖ shouldMarkAsInMaintenance
- ‚úÖ shouldThrowExceptionWhenActivatingWithoutDriver
- ‚úÖ **shouldThrowExceptionWhenActivatingVehicleOlderThan10Years**
- ‚úÖ **shouldThrowExceptionWhenActivatingVehicleWithout4Doors**
- ‚úÖ **shouldThrowExceptionWhenActivatingNonPassengerVehicle**
- ‚úÖ canAcceptRidesShouldReturnTrueWhenActive
- ‚úÖ canAcceptRidesShouldReturnFalseWhenInactive
- ‚úÖ isOwnedByShouldReturnTrueForCorrectDriver
- ...

**LicensePlateTest** (~15 tests):
- ‚úÖ shouldCreateWithValidOldFormat (ABC-1234)
- ‚úÖ shouldCreateWithValidMercosulFormat (ABC1D23)
- ‚úÖ shouldNormalizePlate (remove h√≠fens)
- ‚úÖ shouldThrowExceptionForInvalidFormat
- ‚úÖ shouldThrowExceptionForNullValue
- ‚úÖ shouldFormatPlateCorrectly
- ‚úÖ shouldBeEqualWhenSamePlate
- ...

**VehicleYearTest** (~10 tests):
- ‚úÖ shouldCreateWithValidYear
- ‚úÖ shouldThrowExceptionWhenYearTooOld
- ‚úÖ shouldThrowExceptionWhenYearInFuture
- ‚úÖ shouldCalculateAgeCorrectly
- ‚úÖ isOlderThanShouldWorkCorrectly
- ...

### Use Case Tests

**CreateVehicleUseCaseTest** (~8 tests):
- ‚úÖ shouldCreateVehicleSuccessfully
- ‚úÖ shouldThrowExceptionWhenLicensePlateAlreadyExists
- ‚úÖ shouldCreateWithInactiveStatus
- ‚úÖ shouldValidateAllFields
- ...

**ActivateVehicleUseCaseTest** (~10 tests):
- ‚úÖ shouldActivateVehicleSuccessfully
- ‚úÖ shouldDeactivatePreviousActiveVehicle
- ‚úÖ shouldThrowExceptionWhenVehicleNotFound
- ‚úÖ shouldThrowExceptionWhenNoDriverAssigned
- ‚úÖ shouldHandleTransactionCorrectly
- ...

### Architecture Tests

**Atualizar HexagonalArchitectureTest**:
```java
.orShould().implement(com.rappidrive.application.ports.input.vehicle.CreateVehicleInputPort.class)
.orShould().implement(com.rappidrive.application.ports.input.vehicle.GetVehicleInputPort.class)
.orShould().implement(com.rappidrive.application.ports.input.vehicle.UpdateVehicleInputPort.class)
.orShould().implement(com.rappidrive.application.ports.input.vehicle.AssignVehicleToDriverInputPort.class)
.orShould().implement(com.rappidrive.application.ports.input.vehicle.ActivateVehicleInputPort.class)
```

## Estimativa de Testes

**Total esperado**: ~75 novos testes

- VehicleTest: 30 tests (incrementado com valida√ß√µes de 4 portas, tipo passeio, max 10 anos)
- LicensePlateTest: 15 tests
- VehicleYearTest: 10 tests (com valida√ß√£o de 10 anos)
- CreateVehicleUseCaseTest: 8 tests
- GetVehicleUseCaseTest: 5 tests
- ActivateVehicleUseCaseTest: 10 tests
- AssignVehicleToDriverUseCaseTest: 7 tests

**Total projetado**: 323 testes (248 atuais + 75 novos)

## Crit√©rios de Aceita√ß√£o

- ‚úÖ Domain entities sem framework annotations
- ‚úÖ Value objects imut√°veis com valida√ß√µes
- ‚úÖ Repository ports implementados corretamente
- ‚úÖ Use cases com l√≥gica de neg√≥cio
- ‚úÖ REST API RESTful com DTOs
- ‚úÖ Migration V4 criada
- ‚úÖ √çndice √∫nico condicional funcionando
- ‚úÖ Testes unit√°rios cobrindo todos os cen√°rios
- ‚úÖ Arquitetura hexagonal mantida
- ‚úÖ Todos os testes passando (323 total)

## Pr√≥ximos Passos P√≥s-Implementa√ß√£o

1. **Integra√ß√£o com Driver**: Adicionar endpoint em DriverController para listar ve√≠culos
2. **Documenta√ß√£o Veicular**: Adicionar campos para CRLV, seguro (futuro)
3. **Fotos do Ve√≠culo**: Upload de imagens (S3/CloudStorage)
4. **Hist√≥rico de Manuten√ß√£o**: Rastrear manuten√ß√µes realizadas
5. **Filtro por Tipo**: Passageiros escolhem tipo de ve√≠culo ao solicitar corrida

## Refer√™ncias

- [Padr√£o de Placa Mercosul](https://www.gov.br/infraestrutura/pt-br/assuntos/transito/conteudo-denatran/placa-mercosul)
- Hexagonal Architecture - Alistair Cockburn
- Domain-Driven Design - Eric Evans

---

**Assinatura**: Sistema RappiDrive Backend - Hexagonal Architecture  
**Revis√£o**: üìã Hist√≥ria criada, aguardando implementa√ß√£o  
**Data de Cria√ß√£o**: 03/01/2026
